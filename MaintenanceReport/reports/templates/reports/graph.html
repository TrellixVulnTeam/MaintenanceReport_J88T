{% extends "reports/base_template.html" %}

{% block stylepage %}
{% endblock %}

{% block content %}
<div class="container my-3">
    <div>
        <div id="test"></div>
        <script src="https://code.highcharts.com/highcharts.src.js"></script>
        <p><b>ยอดสรุปผล :</b> จำนวนของการเบิกอะไหล่ที่มีการใช้ ในการซ่อมอุปกรณ์</p>
    </div>
    <div>
        <div id="pie" style="width: 900px; height: 500px;"></div>
        <script src="https://code.highcharts.com/highcharts.src.js"></script>
    </div>

</div>
<div>
    {{datamaintenance}}
    <h1>TEST SET</h1>
    {{datatest}}
    {% for test in datatest %}
    {{test.part_code}}
    {{test.quantity}}
    <br>
    {% endfor %}
    <br>
    <p>Data</p>{{data}}
    <br>
    {% for test in data %}
    {{test.for_machine_id}}
    {{test.part_id}}
    {{test.quantity__sum}}
    <br>
    {% endfor %}

    <br><br><br>
    {{order}}
    {{ chart.as_html }}

</div>

<script>
    Highcharts.chart('test', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'ยอดการเบิกอะไหล่'
        },
        xAxis: {
            type: 'category'
            <!--categories: [-->
            <!--{% for entry in data %}'PART{{ entry.for_machine_id }}'{% if not forloop.last %}, {% endif %}{% endfor %}-->
            <!--]-->
        },
        yAxis: {
            title: {
                text: 'จำนวนยอดการเบิก'
            }
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                    format: '{point.y:.0f} ชิ้น'
                }
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:11px">อะไหล่</span><br>',
            pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.0f} ชิ้น</b> จากทั้งหมด<br/>'
        },
        series: [
            {
                name: 'Part',
                colorByPoint: true,
                data: [
                {% for check in datatest %}
            {
                name:'{{check.part_code}} : {{check.part_desc}}',
                y: {{ check.quantity }},
    },
    {% endfor %}
    ],

    },
    ]
    });
</script>
<script>
    Highcharts.chart('pie', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'ยอดกรายการแจ้งซ่อมเครื่องจักร'
    },
    tooltip: {
        pointFormat: 'จำนวน: {point.y:.0f} ครั้ง <b><br>คิดเป็น : {point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'เครื่องจักร',
        colorByPoint: true,
        data: [

            {% for check in datamaintenance %}
            {
                name:'{{check.machine_name}}',
                y: {{ check.check }}
        },
        {% endfor %}
        ]
    }]
});

</script>
{% endblock %}
